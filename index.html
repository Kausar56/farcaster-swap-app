<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Farswap - Dynamic Base Swap Mini-App</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f4f7f9;
        }
        /* Farcaster Mini-App style adaptation */
        #farswap-app {
            max-width: 400px;
            border: 1px solid #e0e0e0;
        }
        /* Custom scroll classes removed as per user request */
    </style>
</head>
<body class="min-h-screen flex items-start justify-center p-2 sm:p-4">

    <!-- Main App Container -->
    <div id="farswap-app" class="w-full bg-white rounded-2xl shadow-xl overflow-hidden transform transition-all duration-300">
        
        <!-- Header (Header) -->
        <header class="p-4 bg-indigo-600 text-white shadow-md">
            <h1 class="text-xl font-extrabold text-center">Farswap üîó Base</h1>
            <p class="text-xs text-center opacity-80 mt-1">A simple, gas-efficient swap for the Base ecosystem.</p>
        </header>

        <!-- Main Content Area (Mukhya bishay-bastur elaka) -->
        <main id="content-area" class="p-4 h-[500px] overflow-y-auto">
            <!-- Content will be rendered here by JavaScript -->
        </main>

        <!-- Navigation Bar (Nevegeshan bƒÅr) -->
        <nav class="flex justify-around items-center border-t border-gray-100 bg-white p-2">
            <button onclick="showTab('swap')" class="nav-button flex flex-col items-center p-2 rounded-xl transition duration-150 hover:bg-gray-100 text-indigo-600" data-tab="swap">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4" />
                </svg>
                <span class="text-xs mt-1 font-semibold">Swap</span>
            </button>
            <button onclick="showTab('activity')" class="nav-button flex flex-col items-center p-2 rounded-xl transition duration-150 hover:bg-gray-100 text-gray-500" data-tab="activity">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                </svg>
                <span class="text-xs mt-1">Activity</span>
            </button>
            <button onclick="showTab('profile')" class="nav-button flex flex-col items-center p-2 rounded-xl transition duration-150 hover:bg-gray-100 text-gray-500" data-tab="profile">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                </svg>
                <span class="text-xs mt-1">Profile</span>
            </button>
        </nav>
    </div>

    <!-- Modals (General Message and Token Selection) -->
    <div id="general-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-50">
        <div class="bg-white p-6 rounded-xl shadow-2xl w-full max-w-xs transform transition-all duration-300 scale-95 opacity-0" id="general-modal-content">
            <h3 class="text-lg font-bold mb-4 text-indigo-600">Notification</h3>
            <p id="general-modal-message" class="text-gray-700 mb-4"></p>
            <button onclick="closeModal('general-modal')" class="w-full bg-indigo-600 text-white py-2 rounded-lg font-semibold transition duration-200 hover:bg-indigo-700">Close</button>
        </div>
    </div>

    <!-- Token Selection Modal (Token nirbƒÅcana modal) -->
    <div id="token-select-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-end justify-center z-50">
        <div class="bg-white p-6 rounded-t-3xl shadow-2xl w-full max-w-sm h-3/5 transform transition-all duration-300 translate-y-full" id="token-select-content">
            <div class="flex justify-between items-center mb-4 border-b pb-2">
                <h3 class="text-xl font-bold text-gray-800">Select Token</h3>
                <button onclick="closeModal('token-select-modal')" class="text-gray-500 hover:text-gray-800">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                </button>
            </div>
            <div id="token-list" class="space-y-2 overflow-y-auto h-5/6">
                <!-- Token list will be populated here -->
            </div>
        </div>
    </div>


    <script>
        // === Core Data & State Management (Mukhya data ≈ç sthiti byabasthƒÅpanƒÅ) ===

        // Mock token list with contract addresses and simulated real-time prices (Mock token tƒÅlikƒÅ)
        const MOCKED_TOKENS = [
            { id: 'eth', symbol: 'ETH', name: 'Ethereum', logo: 'https://placehold.co/24x24/3c3c3d/ffffff?text=E', price: 3250, balance: 2.5, contractAddress: '0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee', isNative: true }, 
            { id: 'usdc', symbol: 'USDC', name: 'USD Coin', logo: 'https://placehold.co/24x24/2775ca/ffffff?text=U', price: 1.00, balance: 5000, contractAddress: '0x833589fCD6eDbB0E46F5FfDaa9d43ceEe78B9cD1', isNative: false },
            { id: 'usdt', symbol: 'USDT', name: 'Tether USD', logo: 'https://placehold.co/24x24/50af95/ffffff?text=T', price: 1.001, balance: 1000, contractAddress: '0xfd086bc7cd5c481dcc9e859e875f433aa840adaa', isNative: false },
            { id: 'degen', symbol: 'DEGEN', name: 'Degen', logo: 'https://placehold.co/24x24/f7931a/ffffff?text=D', price: 0.0014, balance: 80000, contractAddress: '0x4f3E8539D9a9972bC137F0C8524d77647B056976', isNative: false },
        ];

        const MOCKED_FARCASTER_USER = {
            fid: 10420, 
            username: 'farswap_tester',
            displayName: 'Farswap Tester',
            profilePicture: 'https://placehold.co/100x100/4F46E5/ffffff?text=FC',
            points: 850
        };

        let MOCKED_ACTIVITY = [];

        // Dynamic State for Swap Tab (Swap ·π≠yƒÅber janya dainƒÅmik sthiti)
        let swapState = {
            selectedFromTokenId: 'eth',
            selectedToTokenId: 'usdc',
            selectorTarget: null // 'from' or 'to'
        };
        
        // --- SDK Integration Placeholders (SDK ekƒ´bh≈´ta pleseholdƒÅr) ---

        /**
         * Simulates fetching token data from a Base/Farcaster compatible API
         * @param {string} tokenId - The ID of the token to fetch.
         * @returns {Promise<object>} The token object.
         */
        async function fetchTokenData(tokenId) {
            // In a real Farcaster/Base Mini-App, this is where you'd use a service
            // to fetch real-time market data or on-chain metadata (like ERC-8021).
            await new Promise(resolve => setTimeout(resolve, 50)); // Simulate API delay
            const token = MOCKED_TOKENS.find(t => t.id === tokenId);
            
            if (!token) {
                throw new Error(`Token with ID ${tokenId} not found.`);
            }
            return token;
        }

        /**
         * Simulates a signed transaction via the Base Mini-App SDK.
         * @param {object} transactionData - The transaction details.
         * @returns {Promise<string>} The mocked transaction hash.
         */
        async function executeSwap(transactionData) {
            // This function simulates the core logic of connecting to the user's
            // Farcaster/Base-linked wallet.
            console.log("Simulating Swap Transaction:", transactionData);
            await new Promise(resolve => setTimeout(resolve, 1500)); // Simulate transaction time

            // Mock success (Anukaran saphalatƒÅ)
            return "0xTxHashMocked" + Date.now();
        }

        // === Utility Functions (UpayogitƒÅ fun≈õan) ===

        const $ = (id) => document.getElementById(id);
        const contentArea = $('content-area');

        const formatCurrency = (value) => new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(value);
        const formatNumber = (value) => new Intl.NumberFormat('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 4 }).format(value);
        const truncateAddress = (address) => `${address.substring(0, 6)}...${address.substring(address.length - 4)}`;

        function openModal(modalId, message = '') {
            const modal = $(modalId);
            const modalContent = $(`${modalId}-content`);

            if (modalId === 'general-modal' && $('general-modal-message')) {
                $('general-modal-message').innerHTML = message;
            }

            if (modal) {
                modal.classList.remove('hidden');
                modal.classList.add('flex');
            }
            
            // Transition effect (Paribartana prabhƒÅb) - Added null checks for safety
            if (modalContent) {
                setTimeout(() => {
                    if (modalId === 'general-modal') {
                        modalContent.classList.remove('opacity-0', 'scale-95');
                        modalContent.classList.add('opacity-100', 'scale-100');
                    } else if (modalId === 'token-select-modal') {
                        modalContent.classList.remove('translate-y-full');
                        modalContent.classList.add('translate-y-0');
                    }
                }, 10);
            }
        }

        function closeModal(modalId) {
            const modal = $(modalId);
            const modalContent = $(`${modalId}-content`);

            // Transition effect (Paribartana prabhƒÅb) - Added null checks for safety
            if (modalContent) {
                if (modalId === 'general-modal') {
                    modalContent.classList.remove('opacity-100', 'scale-100');
                    modalContent.classList.add('opacity-0', 'scale-95');
                } else if (modalId === 'token-select-modal') {
                    modalContent.classList.remove('translate-y-0');
                    modalContent.classList.add('translate-y-full');
                }
            }
            
            if (modal) {
                setTimeout(() => {
                    modal.classList.add('hidden');
                    modal.classList.remove('flex');
                }, 300);
            }
        }


        // === Token Selection Logic (Token nirbƒÅcana tarkasƒÅstra) ===

        function openTokenSelector(target) {
            swapState.selectorTarget = target;
            const tokenListElement = $('token-list');
            if (!tokenListElement) return; // Safety check
            tokenListElement.innerHTML = ''; // Clear previous list

            MOCKED_TOKENS.forEach(token => {
                // Determine if the token is currently selected as the *other* token
                let isAlreadySelected = false;
                if (target === 'from' && token.id === swapState.selectedToTokenId) {
                    isAlreadySelected = true;
                }
                if (target === 'to' && token.id === swapState.selectedFromTokenId) {
                    isAlreadySelected = true;
                }

                const buttonClass = isAlreadySelected ? 'opacity-50 cursor-not-allowed' : 'hover:bg-indigo-50';
                const onClickAction = isAlreadySelected ? '' : `selectToken('${token.id}')`;

                tokenListElement.innerHTML += `
                    <button onclick="${onClickAction}" ${isAlreadySelected ? 'disabled' : ''}
                        class="flex items-center justify-between w-full p-3 rounded-xl transition duration-150 ${buttonClass}">
                        <div class="flex items-center space-x-3">
                            <img src="${token.logo}" alt="${token.symbol} Logo" class="w-8 h-8 rounded-full">
                            <div>
                                <p class="text-base font-semibold text-gray-800">${token.symbol}</p>
                                <p class="text-xs text-gray-500">${token.name}</p>
                            </div>
                        </div>
                        <span class="text-sm font-bold text-gray-700">${formatNumber(token.balance)}</span>
                    </button>
                `;
            });

            openModal('token-select-modal');
        }

        window.selectToken = function(tokenId) {
            if (swapState.selectorTarget === 'from') {
                swapState.selectedFromTokenId = tokenId;
            } else if (swapState.selectorTarget === 'to') {
                swapState.selectedToTokenId = tokenId;
            }
            
            closeModal('token-select-modal');
            renderSwapTab(); // Re-render the swap tab with new selections
        }


        // === Swap Tab Rendering & Logic (Swap ·π≠yƒÅb rendƒÅri·πÅ ≈ç tarkasƒÅstra) ===
        
        function updateSwapDisplay(fromToken, toToken) {
            const fromAmountInput = $('from-amount');
            const toAmountInput = $('to-amount');
            const rateElement = $('price-rate-value');

            if (!fromAmountInput || !toAmountInput || !rateElement) return; // Safety check
            
            // 1. Get Input Amount
            const fromAmount = parseFloat(fromAmountInput.value);

            // 2. Calculate Rate
            const rate = fromToken.price / toToken.price;

            // 3. Calculate Estimated Receive (with mock slippage/fee)
            let toAmount = 0;
            if (!isNaN(fromAmount) && fromAmount > 0) {
                 toAmount = fromAmount * rate * 0.997; // 0.3% mock fee
            }
            
            // 4. Update UI
            toAmountInput.value = toAmount > 0 ? formatNumber(toAmount) : '0.00';
            rateElement.innerHTML = `1 ${fromToken.symbol} = ${formatNumber(rate)} ${toToken.symbol}`;

            // Update Balances
            const fromBalanceEl = $('from-balance');
            const toBalanceEl = $('to-balance');
            if (fromBalanceEl) fromBalanceEl.textContent = `Balance: ${formatNumber(fromToken.balance)} ${fromToken.symbol}`;
            if (toBalanceEl) toBalanceEl.textContent = `Balance: ${formatNumber(toToken.balance)} ${toToken.symbol}`;
        }

        window.updateSwapPreview = function() {
            const fromToken = MOCKED_TOKENS.find(t => t.id === swapState.selectedFromTokenId);
            const toToken = MOCKED_TOKENS.find(t => t.id === swapState.selectedToTokenId);
            if (fromToken && toToken) {
                updateSwapDisplay(fromToken, toToken);
            }
        }
        
        window.swapTokens = function() {
            // Swap the IDs in the state
            [swapState.selectedFromTokenId, swapState.selectedToTokenId] = [swapState.selectedToTokenId, swapState.selectedFromTokenId];
            renderSwapTab(); // Re-render the tab to reflect changes
        }

        window.handleSwap = async function() {
            const fromToken = MOCKED_TOKENS.find(t => t.id === swapState.selectedFromTokenId);
            const toToken = MOCKED_TOKENS.find(t => t.id === swapState.selectedToTokenId);
            const fromAmountInput = $('from-amount');
            if (!fromAmountInput) return; // Safety check

            const fromAmount = parseFloat(fromAmountInput.value);
            const toAmount = parseFloat($('to-amount').value.replace(/,/g, ''));

            if (isNaN(fromAmount) || fromAmount <= 0) {
                openModal('general-modal', 'Please enter a valid amount to swap.');
                return;
            }

            if (fromAmount > fromToken.balance) {
                openModal('general-modal', `Insufficient balance. Your ${fromToken.symbol} balance is: ${formatNumber(fromToken.balance)} ${fromToken.symbol}`);
                return;
            }
            
            // Disable button and show loading
            const swapButton = $('confirm-swap-button');
            if (!swapButton) return;
            swapButton.innerHTML = 'Executing Swap...';
            swapButton.disabled = true;

            try {
                // 1. Simulate SDK Execution
                const txHash = await executeSwap({
                    from: fromToken.contractAddress,
                    to: toToken.contractAddress,
                    amount: fromAmount
                });

                // 2. Mock state update on successful transaction
                MOCKED_FARCASTER_USER.points += 5;
                fromToken.balance -= fromAmount;
                toToken.balance += toAmount;

                const newActivity = {
                    id: Date.now(),
                    type: 'Swap',
                    from: fromToken.symbol,
                    to: toToken.symbol,
                    amount: fromAmount,
                    received: toAmount,
                    timestamp: new Date().toLocaleString('en-US'),
                    status: 'Success',
                    txHash: txHash
                };
                MOCKED_ACTIVITY.unshift(newActivity);

                // 3. Show success
                openModal('general-modal', `
                    <p class="text-green-600 font-bold text-xl mb-2">Swap Successful!</p>
                    <p>You sent ${formatNumber(fromAmount)} ${fromToken.symbol} and received ${formatNumber(toAmount)} ${toToken.symbol}.</p>
                    <p class="mt-3 text-sm text-indigo-600">Transaction Hash: ${truncateAddress(txHash)}</p>
                `);

                // 4. Reset display
                $('from-amount').value = '';
                updateSwapPreview();
                renderSwapTab(); // Re-render to show updated balances
                
            } catch (error) {
                openModal('general-modal', `Swap Failed: ${error.message || 'Transaction rejected by wallet.'}`);
            } finally {
                // Re-enable button
                swapButton.innerHTML = 'Confirm Swap';
                swapButton.disabled = false;
            }
        }


        function renderSwapTab() {
            if (!contentArea) return; // Safety check
            const fromToken = MOCKED_TOKENS.find(t => t.id === swapState.selectedFromTokenId);
            const toToken = MOCKED_TOKENS.find(t => t.id === swapState.selectedToTokenId);

            contentArea.innerHTML = `
                <div class="space-y-4">
                    <h2 class="text-2xl font-bold text-gray-800 border-b pb-2 mb-4">Perform Swap</h2>

                    <!-- FROM Token Input (FROM Token Inpu·π≠) -->
                    <div class="bg-gray-50 p-4 rounded-xl border border-gray-200 shadow-sm">
                        <label class="text-sm font-semibold text-gray-500 block mb-1">You Send</label>
                        <div class="flex items-center space-x-3">
                            <input type="number" id="from-amount" value="" min="0" step="any"
                                oninput="updateSwapPreview()"
                                class="flex-grow text-3xl font-mono bg-transparent outline-none focus:ring-0 p-0 text-gray-900 border-none placeholder-gray-400"
                                placeholder="0.0" />
                            <button onclick="openTokenSelector('from')" class="flex items-center space-x-2 bg-indigo-100 p-2 rounded-lg font-bold text-indigo-800 cursor-pointer transition hover:bg-indigo-200 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                <img src="${fromToken.logo}" alt="${fromToken.symbol} Logo" class="w-6 h-6 rounded-full">
                                <span>${fromToken.symbol}</span>
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 ml-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" /></svg>
                            </button>
                        </div>
                        <p id="from-balance" class="text-xs text-gray-500 mt-1">Balance: ${formatNumber(fromToken.balance)} ${fromToken.symbol}</p>
                    </div>

                    <!-- Swap Button (Toggle Tokens) (Swap b≈çtƒÅm) -->
                    <div class="flex justify-center -my-2 z-10">
                        <button onclick="swapTokens()" class="p-2 bg-white rounded-full border-4 border-gray-50 text-indigo-600 hover:text-indigo-800 transition shadow-lg hover:shadow-xl focus:outline-none focus:ring-4 focus:ring-indigo-100">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4" />
                            </svg>
                        </button>
                    </div>

                    <!-- TO Token Input (TO Token Inpu·π≠) -->
                    <div class="bg-gray-50 p-4 rounded-xl border border-gray-200 shadow-sm">
                        <label class="text-sm font-semibold text-gray-500 block mb-1">You Receive (Est.)</label>
                        <div class="flex items-center space-x-3">
                            <input type="text" id="to-amount" readonly
                                class="flex-grow text-3xl font-mono bg-transparent outline-none focus:ring-0 p-0 text-gray-900 border-none"
                                value="0.00" />
                            <button onclick="openTokenSelector('to')" class="flex items-center space-x-2 bg-gray-100 p-2 rounded-lg font-bold text-gray-800 cursor-pointer transition hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-gray-500">
                                <img src="${toToken.logo}" alt="${toToken.symbol} Logo" class="w-6 h-6 rounded-full">
                                <span>${toToken.symbol}</span>
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 ml-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" /></svg>
                            </button>
                        </div>
                        <p id="to-balance" class="text-xs text-gray-500 mt-1">Balance: ${formatNumber(toToken.balance)} ${toToken.symbol}</p>
                    </div>

                    <!-- Swap Details (Swap Bibaran) -->
                    <div class="pt-4 space-y-2 text-sm text-gray-700">
                        <p class="flex justify-between">
                            <span class="font-medium text-gray-500">Current Rate (Sim.):</span>
                            <span id="price-rate-value" class="font-bold text-indigo-600">1 ${fromToken.symbol} = 0.00 ${toToken.symbol}</span>
                        </p>
                        <p class="flex justify-between">
                            <span class="font-medium text-gray-500">Network Fee (Base):</span>
                            <span class="font-bold">~${formatNumber(0.0001)} ETH</span>
                        </p>
                        <p class="flex justify-between">
                            <span class="font-medium text-gray-500">Points Earned:</span>
                            <span class="font-bold text-green-600">+5 Farswap Points</span>
                        </p>
                    </div>

                    <!-- Swap Action Button (Swap kƒÅrya b≈çtƒÅm) -->
                    <button id="confirm-swap-button" onclick="handleSwap()"
                        class="w-full bg-indigo-600 text-white py-3 mt-6 rounded-xl font-extrabold text-lg transition duration-300 transform hover:scale-[1.01] shadow-lg shadow-indigo-500/50 active:bg-indigo-700">
                        Confirm Swap
                    </button>
                </div>
            `;

            updateSwapPreview();
        }

        // === Activity Tab Rendering (kƒÅryakalƒÅp ·π≠yƒÅb rendƒÅri·πÅ) ===
        function renderActivityTab() {
            if (!contentArea) return; // Safety check
            let activityHtml = MOCKED_ACTIVITY.length > 0
                ? MOCKED_ACTIVITY.map(activity => {
                    const statusColor = activity.status === 'Success' ? 'bg-green-100 text-green-700' : 'bg-yellow-100 text-yellow-700';
                    const icon = activity.status === 'Success' 
                        ? `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" /></svg>`
                        : `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>`;

                    return `
                        <div class="flex items-center justify-between p-3 bg-white rounded-xl shadow-sm hover:shadow-md transition duration-150 border border-gray-100">
                            <div class="flex items-center space-x-3">
                                <div class="p-2 rounded-full bg-indigo-50 text-indigo-600">${icon}</div>
                                <div>
                                    <p class="text-sm font-semibold text-gray-800">${activity.type}: ${activity.from} ‚Üí ${activity.to}</p>
                                    <p class="text-xs text-gray-500 mt-1">Sent: ${formatNumber(activity.amount)} ${activity.from} | Received: ${formatNumber(activity.received)} ${activity.to}</p>
                                </div>
                            </div>
                            <div class="text-right">
                                <span class="text-xs font-medium px-2 py-0.5 rounded-full ${statusColor}">${activity.status}</span>
                                ${activity.txHash ? `<p class="text-xs text-gray-400 mt-1 font-mono">${truncateAddress(activity.txHash)}</p>` : ''}
                            </div>
                        </div>
                    `;
                }).join('')
                : '<p class="text-center text-gray-500 p-8 bg-white rounded-xl">No swap activity found here.</p>';

            contentArea.innerHTML = `
                <h2 class="text-2xl font-bold text-gray-800 border-b pb-2 mb-4">Your Activity</h2>
                <div class="space-y-3">
                    ${activityHtml}
                </div>
            `;
        }

        // === Profile Tab Rendering (pr≈çphƒÅil ·π≠yƒÅb rendƒÅri·πÅ) ===
        function renderProfileTab() {
            if (!contentArea) return; // Safety check
            const user = MOCKED_FARCASTER_USER;
            const totalPoints = user.points;
            const pointsPerSwap = 5;
            const totalSwaps = Math.floor(totalPoints / pointsPerSwap);
            
            // Point Card
            const pointCard = `
                <div class="bg-indigo-600 text-white p-6 rounded-xl shadow-xl transform hover:scale-[1.02] transition duration-300">
                    <p class="text-sm opacity-80">Total Farswap Points</p>
                    <h3 class="text-4xl font-extrabold my-2">${totalPoints.toLocaleString('en-US')}</h3>
                    <p class="text-sm opacity-80">You have completed ${totalSwaps.toLocaleString('en-US')} swaps so far.</p>
                </div>
            `;
            
            // Balances List
            const balancesList = MOCKED_TOKENS.map(token => {
                // Check for the native ETH address and hide it as requested
                const isEthNativeAddress = token.isNative && token.contractAddress === '0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee';
                const addressDisplay = isEthNativeAddress 
                    ? `<p class="text-xs text-green-500 font-semibold">Native Base Asset</p>`
                    : `<p class="text-xs text-gray-500 truncate">${truncateAddress(token.contractAddress)}</p>`;
                
                return `
                    <li class="flex justify-between items-center p-3 bg-gray-50 rounded-lg shadow-sm">
                        <div class="flex items-center space-x-3">
                            <img src="${token.logo}" alt="${token.symbol} Logo" class="w-8 h-8 rounded-full border border-gray-300">
                            <div>
                                <span class="font-medium text-gray-800">${token.name} (${token.symbol})</span>
                                ${addressDisplay}
                            </div>
                        </div>
                        <span class="text-indigo-600 font-bold">${formatNumber(token.balance)}</span>
                    </li>
                `;
            }).join('');

            contentArea.innerHTML = `
                <div class="space-y-6">
                    <!-- Farcaster Profile Card (Farcaster Pr≈çphƒÅil KƒÅr·∏ç) -->
                    <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-200 text-center">
                        <img src="${user.profilePicture}" alt="Profile Picture" class="w-20 h-20 rounded-full mx-auto border-4 border-indigo-200 mb-3">
                        <h2 class="text-xl font-bold text-gray-800">${user.displayName}</h2>
                        <p class="text-sm text-indigo-600">@${user.username}</p>
                        <p class="text-xs text-gray-500 mt-2">Farcaster FID: <span class="font-mono bg-gray-100 px-2 py-1 rounded text-gray-700">${user.fid}</span></p>
                    </div>

                    ${pointCard}

                    <!-- Token Balances (Tokener jƒÅmƒÅ) -->
                    <div>
                        <h3 class="text-lg font-bold text-gray-800 mb-3 border-b pb-1">Token Balances (Base)</h3>
                        <ul class="space-y-2">
                            ${balancesList}
                        </ul>
                    </div>
                </div>
            `;
        }

        // === Tab Switching Function (·π¨yƒÅb paribartana fun≈õan) ===
        function showTab(tabName) {
            
            // Update navigation buttons
            document.querySelectorAll('.nav-button').forEach(button => {
                const isActive = button.getAttribute('data-tab') === tabName;
                button.classList.toggle('text-indigo-600', isActive);
                button.classList.toggle('text-gray-500', !isActive);
                button.classList.toggle('font-semibold', isActive);
                const span = button.querySelector('span');
                if (span) {
                    span.classList.toggle('font-semibold', isActive);
                }
            });

            // Render content
            switch (tabName) {
                case 'swap':
                    renderSwapTab();
                    break;
                case 'activity':
                    renderActivityTab();
                    break;
                case 'profile':
                    renderProfileTab();
                    break;
            }
        }

        // Start the app (Applƒ´kesan ≈õuru karun)
        document.addEventListener('DOMContentLoaded', () => {
            // Initial setup of mock activity for a better demo
            MOCKED_ACTIVITY = [
                { id: 1, type: 'Swap', from: 'ETH', to: 'USDC', amount: 0.5, received: 1625.00, timestamp: '2025-11-15 10:30 AM', status: 'Success', txHash: '0x1a2b3c4d5e6f7a8b9c0d1e2f3a4b5c6d7e8f9a0b' },
                { id: 2, type: 'Swap', from: 'USDT', to: 'DEGEN', amount: 50, received: 35500.22, timestamp: '2025-11-14 05:00 PM', status: 'Success', txHash: '0x9a8b7c6d5e4f3a2b1c0d9e8f7a6b5c4d3e2f1a0b' },
            ];

            showTab('swap'); // Show 'Swap' tab by default
        });

    </script>
</body>
</html>